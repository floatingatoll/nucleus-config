stages:
  - deploy

.deploy-aws:
  stage: deploy
  tags:
    - aws
    - frankfurt
    - meao
  script:
    - kubectl apply -f ${DEPLOYMENT}
    - ./rollout-status.sh ${DEPLOYMENT}

deploy frankfurt dev:
  extends: .deploy-aws
  variables:
    DEPLOYMENT: frankfurt/nucleus-dev
    KUBECONFIG: /home/gitlab-runner/.kube/frankfurt.kubeconfig
  only:
    changes:
      - frankfurt/nucleus-dev/*
    refs:
      - master

deploy frankfurt stage:
  extends: .deploy-aws
  variables:
    DEPLOYMENT: frankfurt/nucleus-stage
    KUBECONFIG: /home/gitlab-runner/.kube/frankfurt.kubeconfig
  only:
    changes:
      - frankfurt/nucleus-stage/*
    refs:
      - master

deploy frankfurt prod:
  extends: .deploy-aws
  variables:
    DEPLOYMENT: frankfurt/nucleus-prod
    KUBECONFIG: /home/gitlab-runner/.kube/frankfurt.kubeconfig
  only:
    changes:
      - frankfurt/nucleus-prod/*
    refs:
      - master
