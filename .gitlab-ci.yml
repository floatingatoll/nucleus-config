deploy frankfurt dev:
  variables:
    KUBECONFIG: /home/gitlab-runner/.kube/frankfurt.kubeconfig
  tags:
    - aws
    - frankfurt
    - meao
  only:
    - master
    - frankfurt
  script:
    - kubectl_1.11 apply -f frankfurt/nucleus-dev
    # --timeout requires kubectl 1.12+
    - kubectl_1.11 rollout status -f frankfurt/nucleus-dev/deploy.yaml -w

deploy iowa-b dev:
  variables:
    KUBECONFIG: /home/gitlab-runner/.kube/iowa-b.kubeconfig
  tags:
    - gcp
    - meao
  only:
    - master
    - iowa-b
  script:
    - kubectl_1.12 apply -f iowa-b/nucleus-dev
    - kubectl_1.12 rollout status -f iowa-b/nucleus-dev/deploy.yaml -w --timeout=10m

deploy frankfurt stage:
  variables:
    KUBECONFIG: /home/gitlab-runner/.kube/frankfurt.kubeconfig
  tags:
    - aws
    - frankfurt
    - meao
  only:
    - master
    - frankfurt
    - stage
  script:
    - kubectl_1.11 apply -f frankfurt/nucleus-stage
    # --timeout requires kubectl 1.12+
    - kubectl_1.11 rollout status -f frankfurt/nucleus-stage/deploy.yaml -w

deploy iowa-b stage:
  variables:
    KUBECONFIG: /home/gitlab-runner/.kube/iowa-b.kubeconfig
  tags:
    - gcp
    - meao
  only:
    - master
    - iowa-b
    - stage
  script:
    - kubectl_1.12 apply -f iowa-b/nucleus-stage
    - kubectl_1.12 rollout status -f iowa-b/nucleus-stage/deploy.yaml -w

deploy frankfurt prod:
  variables:
    KUBECONFIG: /home/gitlab-runner/.kube/frankfurt.kubeconfig
  tags:
    - aws
    - frankfurt
    - meao
  only:
    - master
    - frankfurt
    - prod
    - frankfurt-prod
  script:
    - kubectl_1.11 apply -f frankfurt/nucleus-prod
    # --timeout requires kubectl 1.12+
    - kubectl_1.11 rollout status -f frankfurt/nucleus-prod/deploy.yaml -w

deploy iowa-b prod:
  variables:
    KUBECONFIG: /home/gitlab-runner/.kube/iowa-b.kubeconfig
  tags:
    - gcp
    - meao
  only:
    - master
    - iowa-b
    - prod
    - iowa-b-prod
  script:
    - kubectl_1.12 apply -f iowa-b/nucleus-prod
    - kubectl_1.12 rollout status -f iowa-b/nucleus-prod/deploy.yaml -w --timeout=10m
